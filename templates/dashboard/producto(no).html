{% extends 'partials/base.html' %}
{% load crispy_forms_tags %}
{% block title %}Productos{% endblock %}

{% block content %}

  {% include 'partials/topnav.html' %}

  <div class="container my-4">
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow-sm border-0">
          <div
            class="card-body d-flex align-items-center justify-content-center p-3"
            style="background-color: #A0522D; gap: 1rem;"
          >
            <form method="get" class="d-flex align-items-center" style="gap: .5rem;">
              <label for="categoria" class="fw-bold text-white mb-0">Categoría:</label>
              <select
                id="categoria"
                name="categoria"
                class="form-select"
                style="max-width: 300px;"
                onchange="this.form.submit()"
              >
                <option value="Todos" {% if categoria_seleccionada == 'Todos' %}selected{% endif %}>
                  Todas las categorías
                </option>
                {% for categoria in categorias_disponibles %}
                  <option
                    value="{{ categoria.id }}"
                    {% if categoria_seleccionada|stringformat:"s" == categoria.id|stringformat:"s" %}selected{% endif %}
                  >
                    {{ categoria.nombre }}
                  </option>
                {% endfor %}
              </select>
            </form>
          </div>
        </div>
      </div>
    </div>

    {% if messages %}
      <div class="row">
        <div class="col-12">
          {% for message in messages %}
            <div
              class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% else %}alert-info{% endif %} shadow-lg p-3 mb-4 rounded"
              role="alert"
            >
              <h5 class="text-center fw-bold mb-0">
                {% if message.tags == 'success' %}
                  <i class="fas fa-check-circle"></i>
                {% elif message.tags == 'error' %}
                  <i class="fas fa-exclamation-triangle"></i>
                {% else %}
                  <i class="fas fa-info-circle"></i>
                {% endif %}
                {{ message }}
              </h5>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <div class="row g-4">
      <div class="col-lg-4 order-lg-2">
        <div class="card shadow-sm border-0">
          <div
            class="card-header text-white text-center"
            style="background-color: #5A2E1B; font-weight: bold;"
          >
            Agregar Producto
          </div>
          <div class="card-body bg-white">
            <form method="post">
              {% csrf_token %}
              {{ form|crispy }}
              <button
                type="submit"
                class="btn w-100 mt-3"
                style="background-color: #A0522D; color: #FFF;"
              >
                Agregar Producto
              </button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-lg-8 order-lg-1">
        <div class="card shadow-sm border-0">
          <div
            class="card-header text-white text-center"
            style="background-color: #5A2E1B; font-weight: bold;"
          >
            Lista de Productos
          </div>
          <div class="card-body p-0">
            <table class="table table-hover mb-0">
              <thead class="text-white text-center" style="background-color: #8B4513;">
                <tr>
                  <th>Nombre</th>
                  <th>Categoría</th>
                  <th>Cantidad</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                {% for item in items %}
                  <tr class="text-center">
                    <td>{{ item.nombre }}</td>
                    <td>{{ item.categoria.nombre }}</td>
                    <td>{{ item.cantidad }}</td>
                    <td>
                      <a
                        href="{% url 'dashboard-producto-update' item.id %}"
                        class="btn btn-sm"
                        style="background-color: #A0522D; color: #FFF;"
                      >
                        Editar
                      </a>
                      <a
                        href="{% url 'dashboard-producto-delete' item.id %}"
                        class="btn btn-sm"
                        style="background-color: #8B0000; color: #FFF;"
                      >
                        Eliminar
                      </a>
                    </td>
                  </tr>
                {% empty %}
                  <tr>
                    <td colspan="4" class="text-center text-muted">
                      No hay productos en esta categoría.
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
