{% extends 'partials/base.html' %}
{% block title %}Pedidos{% endblock %}

{% block content %}

{% include 'partials/topnav.html' %}

<div class="container my-4">
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm border-0">
        <div
          class="card-body p-3 d-flex flex-wrap align-items-center justify-content-center"
          style="background-color: #A0522D; gap: 20px;"
        >
          <form method="get" class="d-flex align-items-center" style="gap: 1rem;">
            <label for="fecha" class="fw-bold text-white mb-0">Fecha:</label>
            <select
              id="fecha"
              name="fecha"
              class="form-select"
              style="max-width: 200px;"
              onchange="this.form.submit()"
            >
              <option value="Todos" {% if fecha_filtro == 'Todos' %}selected{% endif %}>
                Todos
              </option>
              <option value="Hoy" {% if fecha_filtro == 'Hoy' %}selected{% endif %}>Hoy</option>
              <option value="Este mes" {% if fecha_filtro == 'Este mes' %}selected{% endif %}>Este mes</option>
              <option value="Este año" {% if fecha_filtro == 'Este año' %}selected{% endif %}>Este año</option>
            </select>
            <input
              type="hidden"
              name="usuario"
              value="{{ usuario_filtro|default:'Todos' }}"
            >
          </form>

          <form method="get" class="d-flex align-items-center" style="gap: 1rem;">
            <label for="usuario" class="fw-bold text-white mb-0">Usuario:</label>
            <select
              id="usuario"
              name="usuario"
              class="form-select"
              style="max-width: 200px;"
              onchange="this.form.submit()"
            >
              <option value="Todos" {% if usuario_filtro == 'Todos' %}selected{% endif %}>
                Todos
              </option>
              {% for user in usuarios %}
                <option
                  value="{{ user.id }}"
                  {% if usuario_filtro|stringformat:"s" == user.id|stringformat:"s" %}selected{% endif %}
                >
                  {{ user.username }}
                </option>
              {% endfor %}
            </select>
            <input
              type="hidden"
              name="fecha"
              value="{{ fecha_filtro|default:'Todos' }}"
            >
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      {% if pedidos %}
        <table class="table table-striped mb-0">
          <thead class="text-white text-center" style="background-color: #5A2E1B;">
            <tr>
              <th>Número Pedido</th>
              <th>Pedido por</th>
              <th>Fecha</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for pedido in pedidos %}
              <tr class="text-center">
                <td>{{ pedido.numero_pedido }}</td>
                <td>{{ pedido.usuario.username }}</td>
                <td>{{ pedido.fecha|date:"d/m/Y" }}</td>
                <td>
                  <a
                    href="{% url 'dashboard-pedido-detalles' pedido.id %}"
                    class="btn btn-sm"
                    style="background-color: #A0522D; color: white;"
                  >
                    Ver
                  </a>
                  <form
                    method="post"
                    action="{% url 'dashboard-pedido-delete' pedido.id %}"
                    class="d-inline"
                  >
                    {% csrf_token %}
                    <button
                      type="submit"
                      class="btn btn-sm"
                      style="background-color: #8B0000; color: white;"
                    >
                      Eliminar
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="alert alert-warning text-center mt-3">
          No hay pedidos con los filtros seleccionados.
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}

